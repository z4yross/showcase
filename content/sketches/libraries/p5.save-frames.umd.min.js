/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/p5.save-frames@2.0.0/dist/p5.save-frames.umd.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
(function(p){typeof define=="function"&&define.amd?define(p):p()})(function(){"use strict";var p=Uint8Array,A=Uint16Array,er=Uint32Array,or=new p([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fr=new p([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Tr=new p([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yr=function(e,r){for(var a=new A(31),n=0;n<31;++n)a[n]=r+=1<<e[n-1];for(var t=new er(a[30]),n=1;n<30;++n)for(var i=a[n];i<a[n+1];++i)t[i]=i-a[n]<<5|n;return[a,t]},mr=yr(or,2),$r=mr[0],vr=mr[1];$r[28]=258,vr[258]=28;for(var jr=yr(fr,0),xr=jr[1],lr=new A(32768),w=0;w<32768;++w){var j=(w&43690)>>>1|(w&21845)<<1;j=(j&52428)>>>2|(j&13107)<<2,j=(j&61680)>>>4|(j&3855)<<4,lr[w]=((j&65280)>>>8|(j&255)<<8)>>>1}for(var J=function(e,r,a){for(var n=e.length,t=0,i=new A(r);t<n;++t)e[t]&&++i[e[t]-1];var f=new A(r);for(t=0;t<r;++t)f[t]=f[t-1]+i[t-1]<<1;var v;if(a){v=new A(1<<r);var s=15-r;for(t=0;t<n;++t)if(e[t])for(var l=t<<4|e[t],o=r-e[t],c=f[e[t]-1]++<<o,g=c|(1<<o)-1;c<=g;++c)v[lr[c]>>>s]=l}else for(v=new A(n),t=0;t<n;++t)e[t]&&(v[t]=lr[f[e[t]-1]++]>>>15-e[t]);return v},Y=new p(288),w=0;w<144;++w)Y[w]=8;for(var w=144;w<256;++w)Y[w]=9;for(var w=256;w<280;++w)Y[w]=7;for(var w=280;w<288;++w)Y[w]=8;for(var nr=new p(32),w=0;w<32;++w)nr[w]=5;var Xr=J(Y,9,0),Yr=J(nr,5,0),Ar=function(e){return(e+7)/8|0},Sr=function(e,r,a){(r==null||r<0)&&(r=0),(a==null||a>e.length)&&(a=e.length);var n=new(e.BYTES_PER_ELEMENT==2?A:e.BYTES_PER_ELEMENT==4?er:p)(a-r);return n.set(e.subarray(r,a)),n},Gr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ar=function(e,r,a){var n=new Error(r||Gr[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,ar),!a)throw n;return n},V=function(e,r,a){a<<=r&7;var n=r/8|0;e[n]|=a,e[n+1]|=a>>>8},K=function(e,r,a){a<<=r&7;var n=r/8|0;e[n]|=a,e[n+1]|=a>>>8,e[n+2]|=a>>>16},cr=function(e,r){for(var a=[],n=0;n<e.length;++n)e[n]&&a.push({s:n,f:e[n]});var t=a.length,i=a.slice();if(!t)return[wr,0];if(t==1){var f=new p(a[0].s+1);return f[a[0].s]=1,[f,1]}a.sort(function(F,d){return F.f-d.f}),a.push({s:-1,f:25001});var v=a[0],s=a[1],l=0,o=1,c=2;for(a[0]={s:-1,f:v.f+s.f,l:v,r:s};o!=t-1;)v=a[a[l].f<a[c].f?l++:c++],s=a[l!=o&&a[l].f<a[c].f?l++:c++],a[o++]={s:-1,f:v.f+s.f,l:v,r:s};for(var g=i[0].s,n=1;n<t;++n)i[n].s>g&&(g=i[n].s);var h=new A(g+1),y=sr(a[o-1],h,0);if(y>r){var n=0,E=0,S=y-r,I=1<<S;for(i.sort(function(d,T){return h[T.s]-h[d.s]||d.f-T.f});n<t;++n){var R=i[n].s;if(h[R]>r)E+=I-(1<<y-h[R]),h[R]=r;else break}for(E>>>=S;E>0;){var $=i[n].s;h[$]<r?E-=1<<r-h[$]++-1:++n}for(;n>=0&&E;--n){var M=i[n].s;h[M]==r&&(--h[M],++E)}y=r}return[new p(h),y]},sr=function(e,r,a){return e.s==-1?Math.max(sr(e.l,r,a+1),sr(e.r,r,a+1)):r[e.s]=a},Mr=function(e){for(var r=e.length;r&&!e[--r];);for(var a=new A(++r),n=0,t=e[0],i=1,f=function(s){a[n++]=s},v=1;v<=r;++v)if(e[v]==t&&v!=r)++i;else{if(!t&&i>2){for(;i>138;i-=138)f(32754);i>2&&(f(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(f(t),--i;i>6;i-=6)f(8304);i>2&&(f(i-3<<5|8208),i=0)}for(;i--;)f(t);i=1,t=e[v]}return[a.subarray(0,n),r]},Q=function(e,r){for(var a=0,n=0;n<r.length;++n)a+=e[n]*r[n];return a},ur=function(e,r,a){var n=a.length,t=Ar(r+2);e[t]=n&255,e[t+1]=n>>>8,e[t+2]=e[t]^255,e[t+3]=e[t+1]^255;for(var i=0;i<n;++i)e[t+i+4]=a[i];return(t+4+n)*8},dr=function(e,r,a,n,t,i,f,v,s,l,o){V(r,o++,a),++t[256];for(var c=cr(t,15),g=c[0],h=c[1],y=cr(i,15),E=y[0],S=y[1],I=Mr(g),R=I[0],$=I[1],M=Mr(E),F=M[0],d=M[1],T=new A(19),u=0;u<R.length;++u)T[R[u]&31]++;for(var u=0;u<F.length;++u)T[F[u]&31]++;for(var G=cr(T,7),U=G[0],ir=G[1],_=19;_>4&&!U[Tr[_-1]];--_);var H=l+5<<3,C=Q(t,Y)+Q(i,nr)+f,B=Q(t,g)+Q(i,E)+f+14+3*_+Q(T,U)+(2*T[16]+3*T[17]+7*T[18]);if(H<=C&&H<=B)return ur(r,o,e.subarray(s,s+l));var D,x,z,X;if(V(r,o,1+(B<C)),o+=2,B<C){D=J(g,h,0),x=g,z=J(E,S,0),X=E;var hr=J(U,ir,0);V(r,o,$-257),V(r,o+5,d-1),V(r,o+10,_-4),o+=14;for(var u=0;u<_;++u)V(r,o+3*u,U[Tr[u]]);o+=3*_;for(var L=[R,F],rr=0;rr<2;++rr)for(var Z=L[rr],u=0;u<Z.length;++u){var O=Z[u]&31;V(r,o,hr[O]),o+=U[O],O>15&&(V(r,o,Z[u]>>>5&127),o+=Z[u]>>>12)}}else D=Xr,x=Y,z=Yr,X=nr;for(var u=0;u<v;++u)if(n[u]>255){var O=n[u]>>>18&31;K(r,o,D[O+257]),o+=x[O+257],O>7&&(V(r,o,n[u]>>>23&31),o+=or[O]);var k=n[u]&31;K(r,o,z[k]),o+=X[k],k>3&&(K(r,o,n[u]>>>5&8191),o+=fr[k])}else K(r,o,D[n[u]]),o+=x[n[u]];return K(r,o,D[256]),o+x[256]},qr=new er([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),wr=new p(0),Hr=function(e,r,a,n,t,i){var f=e.length,v=new p(n+f+5*(1+Math.ceil(f/7e3))+t),s=v.subarray(n,v.length-t),l=0;if(!r||f<8)for(var o=0;o<=f;o+=65535){var c=o+65535;c>=f&&(s[l>>3]=i),l=ur(s,l+1,e.subarray(o,c))}else{for(var g=qr[r-1],h=g>>>13,y=g&8191,E=(1<<a)-1,S=new A(32768),I=new A(E+1),R=Math.ceil(a/3),$=2*R,M=function(pr){return(e[pr]^e[pr+1]<<R^e[pr+2]<<$)&E},F=new er(25e3),d=new A(288),T=new A(32),u=0,G=0,o=0,U=0,ir=0,_=0;o<f;++o){var H=M(o),C=o&32767,B=I[H];if(S[C]=B,I[H]=C,ir<=o){var D=f-o;if((u>7e3||U>24576)&&D>423){l=dr(e,s,0,F,d,T,G,U,_,o-_,l),U=u=G=0,_=o;for(var x=0;x<286;++x)d[x]=0;for(var x=0;x<30;++x)T[x]=0}var z=2,X=0,hr=y,L=C-B&32767;if(D>2&&H==M(o-L))for(var rr=Math.min(h,D)-1,Z=Math.min(32767,o),O=Math.min(258,D);L<=Z&&--hr&&C!=B;){if(e[o+z]==e[o+z-L]){for(var k=0;k<O&&e[o+k]==e[o+k-L];++k);if(k>z){if(z=k,X=L,k>rr)break;for(var se=Math.min(L,k-2),Lr=0,x=0;x<se;++x){var Er=o-L+x+32768&32767,ue=S[Er],Or=Er-ue+32768&32767;Or>Lr&&(Lr=Or,B=Er)}}}C=B,B=S[C],L+=C-B+32768&32767}if(X){F[U++]=268435456|vr[z]<<18|xr[X];var Vr=vr[z]&31,Nr=xr[X]&31;G+=or[Vr]+fr[Nr],++d[257+Vr],++T[Nr],ir=o+z,++u}else F[U++]=e[o],++d[e[o]]}}l=dr(e,s,i,F,d,T,G,U,_,o-_,l),!i&&l&7&&(l=ur(s,l+1,wr))}return Sr(v,0,n+Ar(l)+t)},Zr=function(){for(var e=new Int32Array(256),r=0;r<256;++r){for(var a=r,n=9;--n;)a=(a&1&&-306674912)^a>>>1;e[r]=a}return e}(),Jr=function(){var e=-1;return{p:function(r){for(var a=e,n=0;n<r.length;++n)a=Zr[a&255^r[n]]^a>>>8;e=a},d:function(){return~e}}},Kr=function(e,r,a,n,t){return Hr(e,r.level==null?6:r.level,r.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):12+r.mem,a,n,!t)},Rr=function(e,r){var a={};for(var n in e)a[n]=e[n];for(var n in r)a[n]=r[n];return a},m=function(e,r,a){for(;a;++r)e[r]=a,a>>>=8};function Qr(e,r){return Kr(e,r||{},0,0)}var _r=function(e,r,a,n){for(var t in e){var i=e[t],f=r+t,v=n;Array.isArray(i)&&(v=Rr(n,i[1]),i=i[0]),i instanceof p?a[f]=[i,v]:(a[f+="/"]=[new p(0),v],_r(i,f,a,n))}},kr=typeof TextEncoder!="undefined"&&new TextEncoder,Wr=typeof TextDecoder!="undefined"&&new TextDecoder,br=0;try{Wr.decode(wr,{stream:!0}),br=1}catch{}function Fr(e,r){if(r){for(var a=new p(e.length),n=0;n<e.length;++n)a[n]=e.charCodeAt(n);return a}if(kr)return kr.encode(e);for(var t=e.length,i=new p(e.length+(e.length>>1)),f=0,v=function(o){i[f++]=o},n=0;n<t;++n){if(f+5>i.length){var s=new p(f+8+(t-n<<1));s.set(i),i=s}var l=e.charCodeAt(n);l<128||r?v(l):l<2048?(v(192|l>>6),v(128|l&63)):l>55295&&l<57344?(l=65536+(l&1023<<10)|e.charCodeAt(++n)&1023,v(240|l>>18),v(128|l>>12&63),v(128|l>>6&63),v(128|l&63)):(v(224|l>>12),v(128|l>>6&63),v(128|l&63))}return Sr(i,0,f)}var gr=function(e){var r=0;if(e)for(var a in e){var n=e[a].length;n>65535&&ar(9),r+=n+4}return r},Ur=function(e,r,a,n,t,i,f,v){var s=n.length,l=a.extra,o=v&&v.length,c=gr(l);m(e,r,f!=null?33639248:67324752),r+=4,f!=null&&(e[r++]=20,e[r++]=a.os),e[r]=20,r+=2,e[r++]=a.flag<<1|(i==null&&8),e[r++]=t&&8,e[r++]=a.compression&255,e[r++]=a.compression>>8;var g=new Date(a.mtime==null?Date.now():a.mtime),h=g.getFullYear()-1980;if((h<0||h>119)&&ar(10),m(e,r,h<<25|g.getMonth()+1<<21|g.getDate()<<16|g.getHours()<<11|g.getMinutes()<<5|g.getSeconds()>>>1),r+=4,i!=null&&(m(e,r,a.crc),m(e,r+4,i),m(e,r+8,a.size)),m(e,r+12,s),m(e,r+14,c),r+=16,f!=null&&(m(e,r,o),m(e,r+6,a.attrs),m(e,r+10,f),r+=14),e.set(n,r),r+=s,c)for(var y in l){var E=l[y],S=E.length;m(e,r,+y),m(e,r+2,S),e.set(E,r+4),r+=4+S}return o&&(e.set(v,r),r+=o),r},re=function(e,r,a,n,t){m(e,r,101010256),m(e,r+8,a),m(e,r+10,a),m(e,r+12,n),m(e,r+16,t)};function ee(e,r){r||(r={});var a={},n=[];_r(e,"",a,r);var t=0,i=0;for(var f in a){var v=a[f],s=v[0],l=v[1],o=l.level==0?0:8,c=Fr(f),g=c.length,h=l.comment,y=h&&Fr(h),E=y&&y.length,S=gr(l.extra);g>65535&&ar(11);var I=o?Qr(s,l):s,R=I.length,$=Jr();$.p(s),n.push(Rr(l,{size:s.length,crc:$.d(),c:I,f:c,m:y,u:g!=f.length||y&&h.length!=E,o:t,compression:o})),t+=30+g+S+R,i+=76+2*(g+S)+(E||0)+R}for(var M=new p(i+22),F=t,d=i-t,T=0;T<n.length;++T){var c=n[T];Ur(M,c.o,c,c.f,c.u,c.c.length);var u=30+c.f.length+gr(c.extra);M.set(c.c,c.o+u),Ur(M,t,c,c.f,c.u,c.c.length,c.o,c.m),t+=16+u+(c.m?c.m.length:0)}return re(M,t,n.length,d,F),M}const Pr=(e,r)=>{if(e.length===0)return;const a={};e.sort((v,s)=>v.index-s.index).forEach(({filename:v,uint8array:s})=>{a[v]=[s,{level:0}]});const n=ee({[r]:a}),t=new Blob([n],{type:"application/zip"}),i=URL.createObjectURL(t),f=document.createElement("a");f.download=`${r}.zip`,f.href=i,f.click(),URL.revokeObjectURL(i)},Cr="Start capturing",Br="Stop capturing",tr=e=>`${e}`.padStart(7,"0"),ne=e=>{const r=document.createElement("div");return r.style.margin="12px",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.display="flex",r.style.gap="8px",e.appendChild(r),r},ae=e=>{const r=document.createElement("button");return r.innerText=Cr,e.appendChild(r),r},te=e=>{const r=document.createElement("span");return r.style.color="white",r.style.textShadow="0 0 4px black",r.innerText=tr(0),e.appendChild(r),r},ie=e=>{const r=ne(e),a=ae(r),n=te(r);return{container:r,button:a,span:n,updateUi:(i,f)=>{switch(i){case"idle":a.innerText=Cr,a.disabled=!1,n.innerText=tr(0);break;case"capturing":a.innerText=Br,a.disabled=!1,n.innerText=tr(f);break;case"downloading":a.innerText=Br,a.disabled=!0,n.innerText=tr(f);break}}}};let N={},P="idle",q=0,W=[],b;const oe=e=>{const r=e.toLowerCase();return r==="png"?"image/png":r==="jpg"||r==="jpeg"?"image/jpeg":"image/png"},zr=async()=>{const e=q++,a=`frame-${`${e}`.padStart(7,"0")}.${N.extension}`,n=oe(N.extension),t=globalThis._curElement.elt,f=await(await new Promise(s=>t.toBlob(s,n))).arrayBuffer(),v=new Uint8Array(f);return{index:e,filename:a,uint8array:v}},Ir=()=>{P="idle"},Dr=()=>{q=0,W=[]},fe=()=>{if(P="capturing",b(P,q),N.mode==="async"){const e=setInterval(async()=>{switch(P){case"capturing":const r=zr();W.push(r),await r;break;case"downloading":clearInterval(e),Ir();const a=await Promise.all(W);Pr(a,"frames"),Dr();break}b(P,q)},1e3/N.framerate)}},ve=()=>{P="downloading",b(P,q)},le=()=>{N={mode:window.P5_SAVE_FRAMES_MODE||"sync",overrideFramerate:window.P5_SAVE_FRAMES_OVERRIDE_FRAMERATE||!1,framerate:window.P5_SAVE_FRAMES_FRAMERATE||30,extension:window.P5_SAVE_FRAMES_EXTENSION||"png",uiParent:window.P5_SAVE_FRAMES_UI_PARENT||document.body};const e=ie(N.uiParent);if(b=e.updateUi,e.button.addEventListener("click",r=>{switch(r.stopPropagation(),P){case"idle":fe();break;case"capturing":ve();break}}),N.overrideFramerate){const r=window.setup;Object.assign(window,{setup:()=>{r(),frameRate(N.framerate)}})}},ce=async()=>{if(N.mode!=="async"){if(P==="idle")return;switch(P){case"capturing":const e=zr();W.push(e),await e;break;case"downloading":Ir();const r=await Promise.all(W);Pr(r,"frames"),Dr();break}b(P,q)}};p5.prototype.registerMethod("init",le),p5.prototype.registerMethod("post",ce)});
